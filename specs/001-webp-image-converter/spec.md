# 功能规格: WebP图片转换器

**功能分支**: `001-webp-image-converter`
**创建日期**: 2025-10-21
**状态**: 草稿
**用户输入**: "开发一套可以在多平台运行,并且有界面的图片转换系统,支持选择一个本地图片,然后生成一个webp格式的新图片,要求可以选择压缩比,可以默认给定三种,高压缩,普通,低压缩 进行选择,也可以自定义"

## Clarifications

### Session 2025-10-21

- Q: 当用户转换图片时,如果目标位置已存在同名的`.webp`文件,系统应该如何处理? → A: 自动重命名为`原文件名_1.webp`、`原文件名_2.webp`等
- Q: 转换为WebP时,原图片的元数据(如EXIF拍摄信息、地理位置、作者信息等)应该如何处理? → A: 保留所有原始元数据(EXIF/IPTC/XMP)
- Q: WebP支持有损压缩和无损压缩两种模式,系统应该支持哪种? → A: 仅支持有损压缩(质量参数0-100控制有损压缩强度)
- Q: 用户在转换进行中是否可以取消正在进行的操作? → A: 支持取消当前转换,单张转换直接停止,批量转换停止后续任务
- Q: 是否需要设置单张图片的最大尺寸限制? → A: 软性限制(200MB或8000x8000像素),超出时警告但允许继续

## 用户场景与测试 *(必填)*

### User Story 1 - 基础图片转换 (优先级: P1)

用户可以通过图形界面选择本地图片文件,使用预设的压缩质量(高压缩/普通/低压缩),一键将图片转换为WebP格式并保存到本地。

**优先级理由**: 这是核心功能,提供最基本的图片转换能力。没有这个功能,产品无法交付任何价值。这个故事本身就构成了一个可用的MVP。

**独立测试**: 可以通过选择一张PNG或JPEG图片,选择"普通"压缩质量,点击转换按钮,验证是否成功生成WebP文件来完整测试此功能。

**验收场景**:

1. **Given** 用户打开应用程序, **When** 用户点击"选择图片"按钮并选择一张JPEG图片, **Then** 界面显示所选图片的预览和文件信息
2. **Given** 用户已选择图片, **When** 用户选择"普通"压缩质量并点击"转换"按钮, **Then** 系统生成WebP格式文件并保存到默认位置,显示转换成功提示
3. **Given** 用户已选择图片, **When** 用户选择"高压缩"质量并转换, **Then** 生成的WebP文件大小明显小于原图,但质量可接受
4. **Given** 用户已选择图片, **When** 用户选择"低压缩"质量并转换, **Then** 生成的WebP文件质量接近原图,文件大小适度减少
5. **Given** 用户正在转换一张大图片, **When** 用户在转换过程中点击"取消"按钮, **Then** 系统立即停止转换,显示"转换已取消"提示,不生成输出文件

---

### User Story 2 - 自定义压缩质量 (优先级: P2)

用户可以不使用预设的三种压缩质量,而是通过滑块或输入框自定义压缩质量参数(0-100),实现对输出文件大小和质量的精确控制。

**优先级理由**: 为高级用户提供更精细的控制能力,满足特定场景需求(如需要精确控制文件大小)。但对于大多数用户,P1的预设质量已足够。

**独立测试**: 可以通过选择图片后,切换到"自定义"模式,设置质量值为85,验证转换后的文件质量是否符合预期参数来独立测试。

**验收场景**:

1. **Given** 用户已选择图片, **When** 用户点击"自定义"质量选项, **Then** 界面显示质量滑块(范围0-100)和数值输入框
2. **Given** 用户在自定义模式, **When** 用户拖动滑块到75, **Then** 数值输入框同步显示75
3. **Given** 用户设置自定义质量为90, **When** 用户点击转换, **Then** 系统使用质量参数90生成WebP文件
4. **Given** 用户在数值输入框输入超出范围的值(如150), **When** 失去焦点时, **Then** 系统自动修正为有效范围内的最大值(100)并显示提示

---

### User Story 3 - 批量转换 (优先级: P3)

用户可以一次选择多张图片,使用相同的压缩设置批量转换为WebP格式,并查看转换进度和每张图片的转换结果。

**优先级理由**: 提升效率,满足需要处理大量图片的用户需求。但单张转换已能满足基本使用场景。

**独立测试**: 可以通过选择一个包含10张图片的文件夹,设置"普通"质量,点击批量转换,验证是否所有图片都成功转换并显示进度来独立测试。

**验收场景**:

1. **Given** 用户点击"批量选择", **When** 用户选择包含5张图片的文件夹, **Then** 界面显示5张图片的列表和缩略图
2. **Given** 用户已选择多张图片, **When** 用户点击"批量转换", **Then** 系统依次转换每张图片并实时更新进度条(如"2/5 已完成")
3. **Given** 批量转换进行中, **When** 某张图片转换失败, **Then** 系统继续转换剩余图片,并在结果列表中标记失败项和原因
4. **Given** 批量转换完成, **When** 用户查看结果, **Then** 界面显示每张图片的转换状态(成功/失败)、原始大小和转换后大小
5. **Given** 用户正在批量转换10张图片且已完成3张, **When** 用户点击"取消"按钮, **Then** 系统停止后续7张图片的转换,已完成的3张文件保留,显示"批量转换已取消(已完成3/10)"

---

### 边界情况

- 用户选择的文件不是有效图片格式(如选择文本文件)时,系统显示明确的中文错误提示"不支持的文件格式,请选择图片文件(JPEG, PNG, GIF等)"
- 用户选择的图片文件损坏或无法读取时,系统提示"图片文件损坏或无法访问,请检查文件"
- 用户未选择任何图片就点击转换按钮时,系统禁用转换按钮或提示"请先选择要转换的图片"
- 转换后的文件保存位置磁盘空间不足时,系统提示"磁盘空间不足,无法保存转换后的文件"
- 用户选择的图片已经是WebP格式时,系统允许重新转换(可能使用不同质量参数)
- 由于采用有损压缩,转换后的图片与原图存在质量差异(由质量参数决定),这是正常的压缩权衡
- 用户选择超出软性限制的图片(文件大小>200MB或像素尺寸>8000x8000)时,系统显示警告对话框"图片文件较大(XXX MB)或尺寸较大(宽x高),转换可能需要较长时间且消耗较多内存,是否继续?",用户可选择继续或取消
- 用户在批量转换过程中关闭应用时,系统提示"转换正在进行,确定要退出吗?"
- 用户选择的图片接近或达到系统内存限制时,转换可能失败并显示"内存不足,无法处理此图片"错误

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须提供跨平台图形用户界面,支持Windows、macOS和Linux操作系统
- **FR-002**: 系统必须支持选择本地图片文件,至少支持JPEG、PNG、GIF、BMP等常见格式
- **FR-003**: 系统必须能够将所选图片转换为WebP格式(采用有损压缩模式)
- **FR-004**: 系统必须提供三种预设有损压缩质量选项:
  - 高压缩(对应质量参数60):适用于对文件大小敏感的场景
  - 普通(对应质量参数80):平衡质量和大小
  - 低压缩(对应质量参数95):优先保证质量
- **FR-005**: 系统必须允许用户自定义有损压缩质量参数,范围为0-100(0为最低质量最小文件,100为最高质量)
- **FR-006**: 系统必须在转换前显示原始图片的预览、文件名、格式和大小信息
- **FR-007**: 系统必须在转换完成后显示输出文件的保存路径、文件大小和压缩比
- **FR-008**: 系统必须允许用户自定义输出文件的保存位置和文件名
- **FR-009**: 系统必须对不支持的文件格式、文件访问错误、磁盘空间不足等异常情况提供清晰的中文错误提示
- **FR-010**: 系统必须在转换过程中显示进度指示(如进度条或百分比),避免用户误以为程序无响应
- **FR-011**: 系统界面所有文本(按钮、标签、提示信息)必须使用中文
- **FR-012**: 系统必须支持常见的文件路径处理方式(Windows的反斜杠和Unix的斜杠),确保跨平台兼容性
- **FR-013**: 当输出文件名与现有文件冲突时,系统必须自动添加数字后缀重命名(如`原文件名_1.webp`、`原文件名_2.webp`),避免覆盖已有文件
- **FR-014**: 系统必须在转换过程中保留原图片的所有元数据,包括EXIF(拍摄参数、设备信息)、IPTC(作者、版权)和XMP(扩展元数据)信息
- **FR-015**: 系统必须支持用户在转换过程中取消操作:单张转换时立即停止当前转换,批量转换时停止后续未处理的任务(已完成的文件保留)
- **FR-016**: 系统应设置软性尺寸限制(文件大小200MB或像素尺寸8000x8000),当图片超出限制时显示警告信息,但允许用户选择继续转换

### 关键实体

- **图片文件**: 包含文件路径、文件名、格式(JPEG/PNG/等)、尺寸(宽度x高度)、原始大小(字节数)、元数据(EXIF/IPTC/XMP)等属性
- **转换任务**: 包含输入文件引用、输出路径、压缩质量参数、转换状态(待转换/转换中/已完成/失败/已取消)、输出文件大小、耗时等属性
- **质量预设**: 包含预设名称(高压缩/普通/低压缩)、对应的质量参数值(0-100)、描述文本等属性

### 假设

- 用户对WebP格式有基本了解,或至少知道WebP是一种现代图片格式,具有更好的压缩效果
- 用户的操作系统支持现代图形界面框架(如Electron、Qt、Flutter等)
- 转换后的WebP文件默认保存到与原图相同的目录,文件名为"原文件名.webp"
- 应用程序需要有读取原始文件和写入目标目录的文件系统权限
- 对于批量转换,同时处理的最大并发数为合理值(如3-5个),避免系统资源耗尽

## 成功标准 *(必填)*

### 可衡量成果

- **SC-001**: 用户能够在30秒内完成从打开应用、选择图片、选择压缩质量到转换完成的完整流程
- **SC-002**: 转换后的WebP文件大小相比原始JPEG/PNG文件平均减少30%-70%(取决于压缩质量选择)
- **SC-003**: 单张图片转换耗时不超过5秒(对于10MB以内的常见图片)
- **SC-004**: 应用程序能够在Windows 10+、macOS 11+和主流Linux发行版(Ubuntu 20.04+)上正常运行,界面无明显差异
- **SC-005**: 90%的用户在首次使用时无需查看帮助文档即可成功完成图片转换(通过界面直观性实现)
- **SC-006**: 所有错误提示信息使用清晰的中文描述,并提供可操作的建议(如"请检查文件权限"、"请清理磁盘空间")
- **SC-007**: 批量转换10张图片(每张5MB)的总耗时不超过1分钟,且进度显示实时更新
